<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Samsung LATAM Forum ‚Äî Survey</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
    .tap {min-height: 56px}
    .choice[aria-checked="true"]{outline:2px solid #111827; box-shadow: inset 0 0 0 2px #111827}
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <main class="max-w-xl mx-auto p-4 sm:p-6">
    <!-- Header -->
    <header class="mb-4 sm:mb-6">
      <img src="assets/TOP_LOGO.jpg" alt="SAMSUNG" class="w-28" onerror="this.style.display='none'"/>
      <h1 class="text-3xl sm:text-4xl font-bold mt-3">Survey</h1>
      <p class="text-slate-600 mt-1 text-lg">Please answer a few short questions. Large buttons = easy taps üëç</p>
    </header>

    <!-- Progress -->
    <div class="mb-4" aria-label="Progress">
      <div class="flex justify-between text-sm font-medium text-slate-600 mb-1">
        <span id="progressLabel">Step 1 of 5</span>
        <span id="progressPct">0%</span>
      </div>
      <div class="h-3 bg-slate-200 rounded-full overflow-hidden">
        <div id="progressBar" class="h-3 bg-blue-600 w-0"></div>
      </div>
    </div>

    <!-- Form -->
    <form id="surveyForm" class="bg-white rounded-2xl shadow p-4 sm:p-6 space-y-6" novalidate>
      <!-- Step 1: About You -->
      <section class="step" data-step="1">
        <h2 class="text-2xl font-semibold mb-2">About you</h2>
        <p class="text-slate-600 mb-4">Choose your Samsung subsidiary and group.</p>

        <!-- Subsidiary -->
        <label class="block text-lg font-medium mb-2">From which Samsung subsidiary are you from?<span class="text-red-600"> *</span></label>
        <div id="subsidiary" class="grid grid-cols-1 gap-2" role="radiogroup" aria-labelledby="subsidiary">
          <!-- options -->
        </div>

        <!-- Group -->
        <label class="block text-lg font-medium mt-6 mb-2">Which group do you represent?<span class="text-red-600"> *</span></label>
        <div id="group" class="grid grid-cols-1 gap-2" role="radiogroup" aria-labelledby="group">
          <!-- options -->
        </div>
      </section>

      <!-- Step 2: Overall Enjoyment -->
      <section class="step hidden" data-step="2">
        <h2 class="text-2xl font-semibold mb-2">Overall</h2>
        <p class="text-slate-600 mb-4">Tap a number (0‚Äì10). Bigger = better.</p>
        <div class="space-y-6">
          <div>
            <label class="block font-medium mb-2">Power of Konnection ‚Äî Latin Forum 2023</label>
            <div class="likert" data-key="overall_forum"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Samsung Digital City visit</label>
            <div class="likert" data-key="digital_city"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Business Meetings</label>
            <div class="likert" data-key="meetings"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Gala Dinner</label>
            <div class="likert" data-key="gala"></div>
          </div>
        </div>
      </section>

      <!-- Step 3: Hospitality -->
      <section class="step hidden" data-step="3">
        <h2 class="text-2xl font-semibold mb-2">Hospitality</h2>
        <div class="space-y-6">
          <div>
            <label class="block font-medium mb-2">Busan Hospitality day</label>
            <div class="likert" data-key="busan_day"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Seoul Hospitality day</label>
            <div class="likert" data-key="seoul_day"></div>
          </div>
        </div>
      </section>

      <!-- Step 4: Food & Beverage -->
      <section class="step hidden" data-step="4">
        <h2 class="text-2xl font-semibold mb-2">Food & Beverage</h2>
        <div class="space-y-6">
          <div>
            <label class="block font-medium mb-2">Welcome Dinner</label>
            <div class="likert" data-key="welcome_dinner"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Busan Lunch</label>
            <div class="likert" data-key="busan_lunch"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Busan Happy Hour</label>
            <div class="likert" data-key="busan_happy"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Seoul Lunch</label>
            <div class="likert" data-key="seoul_lunch"></div>
          </div>
          <div>
            <label class="block font-medium mb-2">Seoul Dinner</label>
            <div class="likert" data-key="seoul_dinner"></div>
          </div>
        </div>
      </section>

      <!-- Step 5: Comments & When/Where -->
      <section class="step hidden" data-step="5">
        <h2 class="text-2xl font-semibold mb-2">Final</h2>
        <div class="space-y-4">
          <label class="block">
            <span class="block font-medium mb-2">Any additional comments and/or suggestions?</span>
            <textarea id="comments" class="w-full rounded-xl border border-slate-300 p-3 text-lg" rows="4" placeholder="Type here‚Ä¶"></textarea>
          </label>
          <label class="block">
            <span class="block font-medium mb-2">When would you suggest having the next Latin Forum?</span>
            <input id="next_when" type="text" class="w-full rounded-xl border border-slate-300 p-3 text-lg" placeholder="e.g., July 2026"/>
          </label>
          <label class="block">
            <span class="block font-medium mb-2">Where would you suggest having the next Latin Forum?</span>
            <input id="next_where" type="text" class="w-full rounded-xl border border-slate-300 p-3 text-lg" placeholder="e.g., S√£o Paulo"/>
          </label>
        </div>
      </section>

      <!-- Nav -->
      <div class="flex items-center justify-between pt-2">
        <button type="button" id="btnPrev" class="tap px-4 py-3 rounded-xl bg-slate-200 text-slate-900 font-semibold disabled:opacity-40">‚óÄ Previous</button>
        <button type="button" id="btnSave" class="tap px-4 py-3 rounded-xl bg-amber-100 text-amber-900 font-semibold">Save and resume later</button>
        <button type="button" id="btnNext" class="tap px-5 py-3 rounded-xl bg-blue-600 text-white font-semibold">Next ‚ñ∂</button>
        <button type="submit" id="btnSubmit" class="tap px-5 py-3 rounded-xl bg-emerald-600 text-white font-semibold hidden">Submit</button>
      </div>

      <p id="helper" class="text-center text-slate-600 text-sm">You can come back later. Your progress is saved on this device.</p>
    </form>

    <footer class="text-center text-xs text-slate-500 mt-6">Power of Konnection</footer>
  </main>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
  /********************
   * 1) CONFIG ‚Äî Edit this
   ********************/
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "",
    appId: ""
  };
  // Collection name in Firestore
  const COLLECTION = 'latam_forum_survey';

  /********************
   * 2) INIT
   ********************/
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById('surveyForm');
  const steps = Array.from(document.querySelectorAll('.step'));
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const btnSubmit = document.getElementById('btnSubmit');
  const btnSave = document.getElementById('btnSave');
  const progressBar = document.getElementById('progressBar');
  const progressLabel = document.getElementById('progressLabel');
  const progressPct = document.getElementById('progressPct');

  const LS_KEY = 'survey_draft_v1';
  const state = loadDraft() || { step:1, data:{} };

  // Options data
  const subsidiaries = [
    'Argentina, Uruguay, Paraguay', 'Brazil', 'Central America, Caribbean, Miami', 'Chile, Bolivia', 'Colombia', 'Mexico', 'Peru', 'LAO (RHQ)', 'Korea (HQ)'
  ];
  const groups = ['Retailer','Samsung'];

  // Render subsidiary & group choices
  const asRadio = (name, value) => {
    const id = `${name}_${value.replace(/[^a-z0-9]/gi,'_')}`;
    return `\n<label class="choice flex items-center gap-3 border rounded-xl p-3 tap cursor-pointer" tabindex="0" role="radio" aria-checked="false" data-name="${name}" data-value="${value}">\n  <span class="w-6 h-6 rounded-full border flex items-center justify-center bg-white"><span class="dot w-3 h-3 rounded-full bg-blue-600 opacity-0"></span></span>\n  <span class="text-lg">${value}</span>\n</label>`
  }
  document.getElementById('subsidiary').innerHTML = subsidiaries.map(v => asRadio('subsidiary', v)).join('');
  document.getElementById('group').innerHTML = groups.map(v => asRadio('group', v)).join('');

  // Restore selections if any
  function restoreRadios(){
    document.querySelectorAll('.choice').forEach(el=>{
      const name = el.dataset.name; const value = el.dataset.value;
      const on = state.data[name] === value;
      el.setAttribute('aria-checked', on? 'true':'false');
      el.querySelector('.dot').style.opacity = on? '1':'0';
    });
  }

  // Radio interactions (big tap labels)
  document.addEventListener('click', (e)=>{
    const label = e.target.closest('.choice');
    if(!label) return;
    const name = label.dataset.name;
    const value = label.dataset.value;
    state.data[name] = value;
    // clear others
    document.querySelectorAll(`.choice[data-name="${name}"]`).forEach(el=>{
      const on = el===label;
      el.setAttribute('aria-checked', on? 'true':'false');
      el.querySelector('.dot').style.opacity = on? '1':'0';
    });
    saveDraft();
  });

  // Likert 0-10 renderers
  function renderLikerts(){
    document.querySelectorAll('.likert').forEach(box=>{
      const key = box.dataset.key;
      const cur = state.data[key];
      const row = document.createElement('div');
      row.className = 'grid grid-cols-6 sm:grid-cols-11 gap-2';
      for(let i=0;i<=10;i++){
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'tap w-full rounded-xl border p-3 text-lg font-semibold bg-white';
        b.textContent = i;
        if(cur===i) b.classList.add('!bg-blue-600','!text-white');
        b.addEventListener('click', ()=>{
          state.data[key] = i;
          saveDraft();
          // highlight
          row.querySelectorAll('button').forEach(x=>x.classList.remove('!bg-blue-600','!text-white'));
          b.classList.add('!bg-blue-600','!text-white');
        });
        row.appendChild(b);
      }
      box.innerHTML=''; box.appendChild(row);
    });
  }

  // Comments inputs bind
  ['comments','next_when','next_where'].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener('input', ()=>{ state.data[id]=el.value; saveDraft(); });
  });

  // Stepper
  function showStep(n){
    state.step = Math.max(1, Math.min(5, n));
    steps.forEach(s=> s.classList.toggle('hidden', Number(s.dataset.step)!==state.step));
    btnPrev.disabled = state.step===1;
    btnNext.classList.toggle('hidden', state.step===5);
    btnSubmit.classList.toggle('hidden', state.step!==5);
    const pct = Math.round((state.step-1)/(steps.length-1)*100);
    progressBar.style.width = pct+'%';
    progressLabel.textContent = `Step ${state.step} of ${steps.length}`;
    progressPct.textContent = `${pct}%`;
    saveDraft();
  }

  btnPrev.addEventListener('click', ()=> showStep(state.step-1));
  btnNext.addEventListener('click', ()=>{
    // simple required check for step 1
    if(state.step===1){
      if(!state.data.subsidiary || !state.data.group){
        alert('Please select subsidiary and group.');
        return;
      }
    }
    showStep(state.step+1)
  });

  btnSave.addEventListener('click', ()=>{
    saveDraft();
    alert('Saved on this device. You can close and come back later.');
  });

  // Submit handler ‚Äî Firestore direct write (Option B)
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    // basic validation
    if(!state.data.subsidiary || !state.data.group){
      showStep(1); alert('Please complete required fields.'); return;
    }
    const payload = {
      ...state.data,
      created_at: new Date().toISOString(),
      user_agent: navigator.userAgent,
    };

    toggleLoading(true);
    try{
      await db.collection(COLLECTION).add(payload);
      localStorage.removeItem(LS_KEY);
      toggleLoading(false);
      alert('Thank you! Your response has been submitted.');
      window.location.assign('thankyou.html');
    }catch(err){
      toggleLoading(false);
      console.error(err);
      alert('Submission failed. Please check your connection and try again.');
    }

    /*
    // Option A: POST to Cloud Functions endpoint instead of direct Firestore
    try{
      const res = await fetch('https://YOUR_REGION-YOUR_PROJECT.cloudfunctions.net/submitSurvey',{
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('HTTP '+res.status);
      localStorage.removeItem(LS_KEY);
      alert('Thank you! Your response has been submitted.');
    }catch(e){ alert('Failed to submit.'); }
    */
  });

  function toggleLoading(on){
    [btnPrev,btnNext,btnSubmit,btnSave].forEach(b=> b.disabled = !!on);
    btnSubmit.textContent = on? 'Submitting‚Ä¶': 'Submit';
  }

  function saveDraft(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
  function loadDraft(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)); }catch{ return null; } }

  // Boot
  restoreRadios();
  renderLikerts();
  // restore text
  ['comments','next_when','next_where'].forEach(id=>{ const v = state.data[id]; if(v) document.getElementById(id).value = v; });
  showStep(state.step||1);
  </script>

  <!--
  =============================
  FIREBASE SECURITY RULES (Option B: direct write)
  Console > Firestore > Rules
  -----------------------------
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /latam_forum_survey/{docId} {
        allow create: if request.time < timestamp.date(2100,1,1)
          && request.resource.data.keys().hasAll(['subsidiary','group','created_at'])
          && request.resource.data.subsidiary is string
          && request.resource.data.group is string
          && request.resource.data.created_at is string
          && request.resource.data.size() <= 50; // prevent spam payloads
        allow read, update, delete: if false; // public cannot read
      }
    }
  }

  =============================
  CLOUD FUNCTIONS (Option A)
  functions/index.js (Node 18)
  -----------------------------
  const functions = require('firebase-functions/v2/https');
  const admin = require('firebase-admin');
  admin.initializeApp();
  exports.submitSurvey = functions.onRequest(async (req, res) => {
    res.set('Access-Control-Allow-Origin','*');
    if (req.method === 'OPTIONS') return res.status(204).send('');
    if (req.method !== 'POST') return res.status(405).send('Method Not Allowed');
    const data = req.body || {};
    try{
      await admin.firestore().collection('latam_forum_survey').add({
        ...data,
        server_ts: admin.firestore.FieldValue.serverTimestamp(),
      });
      res.json({ok:true});
    }catch(e){ res.status(500).json({ok:false, error: String(e)}); }
  });
  -->
</body>
</html>
