<!DOCTYPE html>
<html>
<head>
  <title>ê²½ë¡œ ì•ˆë‚´ (Seoul)</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #map { height: 70vh; width: 100%; }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <!-- ğŸ”™ ìƒë‹¨ ë’¤ë¡œê°€ê¸° + ì œëª© -->
  <div class="flex items-center justify-between max-w-md mx-auto mb-4">
    <button onclick="goHome()" class="text-sm text-blue-600 hover:underline">â† Back</button>
    <h1 class="text-xl font-bold text-center flex-1 -ml-6">ğŸ“ Maps</h1>
  </div>

  <!-- ëª©ì ì§€ ë²„íŠ¼ -->
  <div class="grid grid-cols-2 gap-4 mb-4 max-w-md mx-auto">
    <button onclick="routeTo('shilla')" class="bg-white py-2 px-4 rounded shadow hover:bg-gray-200">ğŸ¨ The Shilla Seoul</button>
    <button onclick="routeTo('digitalcity')" class="bg-white py-2 px-4 rounded shadow hover:bg-gray-200">ğŸ¢ Samsung Digital City</button>
    <button onclick="routeTo('umyeonrnd')" class="bg-white py-2 px-4 rounded shadow hover:bg-gray-200">ğŸ§ª Umyeon R&amp;D Campus</button>
    <button onclick="routeTo('hyundae')" class="bg-white py-2 px-4 rounded shadow hover:bg-gray-200">ğŸ›ï¸ The Hyundai Seoul</button>
    <button onclick="routeTo('housenowhere')" class="bg-white py-2 px-4 rounded shadow hover:bg-gray-200">ğŸ§± House Nowhere Seoul</button>
  </div>

  <!-- ê±°ë¦¬, ì‹œê°„ ì•ˆë‚´ -->
  <div id="routeInfo" class="text-center text-sm text-gray-700 mt-2 mb-4 whitespace-pre-line"></div>

  <!-- ì§€ë„ -->
  <div id="map" class="rounded shadow"></div>

  <script>
    // âœ… ëª©ì ì§€ ì¢Œí‘œ
    const destinations = {
      shilla:      { lat: 37.555890, lng: 127.005150 }, // The Shilla Seoul
      digitalcity: { lat: 37.256910, lng: 127.051260 }, // Samsung Digital City (Suwon)
      umyeonrnd:   { lat: 37.465110, lng: 127.023470 }, // Umyeon R&D Campus (ë³´ì •)
      hyundae:     { lat: 37.525960, lng: 126.928420 }, // The Hyundai Seoul (Yeouido)
      housenowhere:{ lat: 37.537973, lng: 127.058702 }  // House Nowhere Seoul (Seongsu)
    };

    // âœ… ìœ„ì¹˜ ì‹¤íŒ¨ ëŒ€ë¹„ ê¸°ë³¸ ì¶œë°œì§€ & Geolocation ì˜µì…˜
    const DEFAULT_ORIGIN = destinations.shilla;
    const GEO_OPTIONS = { enableHighAccuracy: true, timeout: 8000, maximumAge: 60000 };

    let map, directionsService, directionsRenderer, distanceService, fallbackLine = null;
    const routeInfoDiv = document.getElementById("routeInfo");

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: { lat: 37.5665, lng: 126.9780 }, // ì„œìš¸ ì‹œì²­ ë¶€ê·¼
      });
      directionsService  = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);
      distanceService    = new google.maps.DistanceMatrixService();
    }

    // ğŸ“ Haversine ê±°ë¦¬(m)
    function haversine(a, b){
      const R = 6371000; // m
      const toRad = d => d * Math.PI / 180;
      const dLat = toRad(b.lat - a.lat);
      const dLng = toRad(b.lng - a.lng);
      const lat1 = toRad(a.lat), lat2 = toRad(b.lat);
      const h = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLng/2)**2;
      return 2*R*Math.asin(Math.sqrt(h));
    }
    const fmtKm = (m)=> `${(m/1000).toFixed(1)} km`;
    const estWalkSec = (m)=> Math.round(m / 1.33); // 1.33 m/s â‰ˆ 4.8 km/h
    function fmtDur(sec){
      const h = Math.floor(sec/3600), m = Math.round((sec%3600)/60);
      return h ? `${h}h ${m}m` : `${m} min`;
    }

    function clearOverlays(){
      directionsRenderer.setMap(null);
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);
      if (fallbackLine){ fallbackLine.setMap(null); fallbackLine = null; }
    }

    function fitBounds(a, b){
      const bounds = new google.maps.LatLngBounds();
      bounds.extend(a); bounds.extend(b);
      map.fitBounds(bounds, 64);
    }

    // âœ… ê²½ë¡œ ìš”ì²­: ë„ë³´ ìš°ì„ . ZERO_RESULTS ë“±ì¼ ë•Œ ì§ì„ ê±°ë¦¬ë¡œ ì•ˆë‚´ + ëŒ€ì²´ í´ë¦¬ë¼ì¸ í‘œì‹œ.
    function routeTo(key) {
      const destination = destinations[key];

      const requestAll = (origin) => {
        clearOverlays();

        // 1) ë„ë³´ Distance Matrix (ì‹œê°„/ê±°ë¦¬ ë¨¼ì € ê³„ì‚°)
        distanceService.getDistanceMatrix({
          origins: [origin],
          destinations: [destination],
          travelMode: google.maps.TravelMode.WALKING
        }, (res, status) => {
          let topLine = "", subLine = "";

          if (status === "OK" && res.rows[0].elements[0].status === "OK") {
            const el = res.rows[0].elements[0];
            topLine = `ğŸš¶ From your location â†’ Destination`;
            subLine = `â±ï¸ ${el.duration.text} (${el.distance.text})`;
          } else {
            // ê±°ë¦¬/ì‹œê°„ ëª» ë°›ìœ¼ë©´ Haversineë¡œ ê·¼ì‚¬
            const m = haversine(origin, destination);
            topLine = `ğŸš¶ (Approx.) From your location â†’ Destination`;
            subLine = `â±ï¸ ~${fmtDur(estWalkSec(m))} (${fmtKm(m)})`;
          }
          routeInfoDiv.innerText = `${topLine}\n${subLine}`;
        });

        // 2) ë„ë³´ Directions (ì‹¤ì œ ê²½ë¡œ ê·¸ë¦¬ê¸°)
        directionsService.route(
          { origin, destination, travelMode: google.maps.TravelMode.WALKING },
          (response, status) => {
            if (status === "OK") {
              directionsRenderer.setDirections(response);
            } else {
              // ZERO_RESULTS ë“± â†’ ì§ì„  í´ë¦¬ë¼ì¸ìœ¼ë¡œ ëŒ€ì²´ í‘œê¸°
              fallbackLine = new google.maps.Polyline({
                path: [origin, destination],
                map,
                strokeOpacity: 0.8,
                strokeWeight: 4
              });
              fitBounds(origin, destination);
              console.warn("Directions error:", status, { origin, destination });
            }
          }
        );
      };

      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (pos) => requestAll({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
          ()   => requestAll(DEFAULT_ORIGIN),
          GEO_OPTIONS
        );
      } else {
        requestAll(DEFAULT_ORIGIN);
      }
    }
  </script>

  <!-- âœ… Google Maps API (HTTPS/localhost ê¶Œì¥) -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfHkgQ8w0T0-JlGESZiLbFAAgULg46I4A&callback=initMap">
  </script>

  <script>
    function goHome() { window.location.href = "index.html"; }
  </script>
</body>
</html>
